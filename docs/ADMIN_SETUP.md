
# Admin Setup Guide

## Overview

The "Play Store Assets" button is now protected and only visible to admin users. This guide explains how to manage admin access.

## Admin Users Table

A new `admin_users` table has been created in Supabase with the following structure:

```sql
create table admin_users (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id) on delete cascade unique not null,
  created_at timestamptz default now(),
  updated_at timestamptz default now()
);
```

## How It Works

1. **Authentication Check**: When a user logs in, the app checks if their user ID exists in the `admin_users` table
2. **Conditional Visibility**: The "Play Store Assets" button only appears on the Dashboard if the user is an admin
3. **Security Badge**: Admin users see a small security badge next to the button indicating their admin status

## Adding Admin Users

### Method 1: Using Supabase Dashboard

1. Go to your Supabase project dashboard
2. Navigate to the SQL Editor
3. Run the following query (replace `USER_UUID` with the actual user ID):

```sql
INSERT INTO admin_users (user_id)
VALUES ('USER_UUID');
```

### Method 2: Using Supabase Client

```typescript
import { supabase } from '@/app/integrations/supabase/client';

async function addAdminUser(userId: string) {
  const { data, error } = await supabase
    .from('admin_users')
    .insert({ user_id: userId });
  
  if (error) {
    console.error('Error adding admin user:', error);
  } else {
    console.log('Admin user added successfully');
  }
}
```

## Finding User IDs

To find a user's ID:

1. Go to Supabase Dashboard → Authentication → Users
2. Click on the user you want to make an admin
3. Copy their UUID from the user details

## Removing Admin Access

To remove admin access from a user:

```sql
DELETE FROM admin_users
WHERE user_id = 'USER_UUID';
```

## Row Level Security (RLS)

The `admin_users` table has RLS enabled with the following policies:

- **View**: All authenticated users can view the admin_users table (to check if they are admin)
- **Insert**: Only existing admins can add new admins
- **Delete**: Only existing admins can remove admins

## Admin Panel Access

The Admin Panel (`/admin`) is still protected by a passcode (default: `1234`). This is separate from the admin_users table and is used for managing anomaly patterns.

## Security Considerations

- The first admin user must be added manually via SQL
- After the first admin is added, they can add other admins through the app
- User IDs are UUIDs generated by Supabase Auth
- RLS policies ensure only admins can modify the admin_users table
- The Play Store Assets feature is completely hidden from non-admin users

## Testing

To test admin functionality:

1. Create a test user account
2. Add their user ID to the admin_users table
3. Log in with that account
4. The "Play Store Assets" button should now be visible on the Dashboard
5. The button should have a security badge icon

## Troubleshooting

If the button doesn't appear:

1. Check that the user is logged in
2. Verify the user ID exists in the admin_users table
3. Check the browser console for any errors
4. Ensure RLS policies are enabled on the admin_users table
5. Try refreshing the app or logging out and back in
